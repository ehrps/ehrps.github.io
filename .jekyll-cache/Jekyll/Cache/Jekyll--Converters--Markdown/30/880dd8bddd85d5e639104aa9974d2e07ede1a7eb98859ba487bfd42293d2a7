I"<h1 id="vi">vi</h1>

<hr />

<p>Linux vi 命令也就是指 vi 编辑器，它们是一个意思。vi 编辑器是 Linux/UNIX 环境下经典的编辑器。Linux vi 命令非常强大，熟练地使用它可以高效的编辑代码，配置系统文件等，是程序员和运维人员必须掌握的技能。</p>

<p>可以说每一个 Linux 程序员都是从学习使用 vi 开始学习 Linux 环境编程的。因此，即使是在集成开发环境盛行的今天，是否能够熟练使用 vi 仍然被看做是衡量 Linux 程序员基本功的标准之一。</p>

<p>vi 对于 Linux 运维人员同样重要，不会使用 vi，运维就无从谈起。</p>

<p>vi 可以执行输出、删除、查找、替换、块操作等众多文本操作，而且用户可以根据自己的需要对其进行定制。</p>

<p>vi 编辑器只是一个文本编辑程序，它没有菜单，只有命令，且命令繁多。虽然学习这些命令比较费时费力，但是一旦你掌握了这些命令，你就会发现 vi 十分高效和强大，丝毫不逊色任何一款 Windows 上的编辑器，让我们从这套入门教程开始吧。</p>

<p>其实，现在的 UNIX/Linux 大都使用 vim 代替了 vi。vim 是 vi 的增强版（vi Improved），与 vi 编辑器完全兼容，而且实现了很多增强功能。</p>

<p>vi 编辑器会依据文件扩展名或者是文件内的开头信息， 判断该文件的内容而自动的执行该程序的语法判断式，再以颜色来显示程序代码与一般信息。</p>

<p>在某些发行版中，例如 CentOS 或者 Read Hat，当系统安装完毕后，vi/vim 编辑器默认就已经被安装了。在其他一些发行版中，例如 Debian 或者 Ubuntu，默认情况下 vi/vim 是不会被安装的，你需要自己手动安装。</p>

<p>好了，让我们赶紧开始 Linux vi 命令的学习之旅吧。</p>

<h2 id="vi工作模式3种以及模式切换转换">vi工作模式（3种）以及模式切换（转换）</h2>

<p>vi 编辑器是一个功能强大的编辑器。学习 vi 要从其基本工作模式开始学起。了解这些工作模式对用户理解 vi 编辑器的行为是不无裨益的。</p>

<p>对于一些从图形界面中转入 vi 的开发者来说，了解 vi 的工作模式十分重要。本节将深入讨论 vi 编辑器的工作模式。</p>

<p>vi 编辑器有 3 种基本工作模式，分别是<strong>命令模式、文本输入模式和末行模式</strong>。下面详 细介绍这 3 种模式。</p>

<h4 id="1-命令行模式">1) 命令行模式</h4>

<p>该模式是进入 vi 编辑器后的默认模式。任何时候，不管用户处于何种模式，按下<code class="language-plaintext highlighter-rouge">Esc</code>键即可进入命令模式。</p>

<p>在命令模式下，用户可以输入 vi 命令，用于管理自己的文档。此时从键盘上输入的任何字符都被当做编辑命令来解释。若输入的字符是合法的 vi 命令，则 vi 在接受用户命令之后完成相应的动作。</p>

<p>但需注意的是，所输入的命令并不回显在屏幕上。若输入的字符不是 vi 的合法命令，vi 会响铃报警。</p>

<h4 id="2-文本输入模式">2) 文本输入模式</h4>

<p>在命令模式下输入插入命令<code class="language-plaintext highlighter-rouge">i</code>、附加命令<code class="language-plaintext highlighter-rouge">a</code>、打开命令<code class="language-plaintext highlighter-rouge">o</code>、修改命令<code class="language-plaintext highlighter-rouge">c</code>、取代命令<code class="language-plaintext highlighter-rouge">r</code>或替换命令<code class="language-plaintext highlighter-rouge">s</code>都可以进入文本输入模式。</p>

<p>在该模式下，用户输入的任何字符都被 vi 当做文件内容保存起来，并将其显示在屏幕上。在文本输入过程中，若想回到命令模式下，按下<code class="language-plaintext highlighter-rouge">Esc</code>键即可。</p>

<h4 id="3-末行模式">3) 末行模式</h4>

<p>末行模式也称 ex 转义模式。</p>

<p>在命令模式下，用户按<code class="language-plaintext highlighter-rouge">:</code>键即可进入末行模式下，此时 vi 会在显示窗口的最后一行（通常也是屏幕的最后一行）显示一个<code class="language-plaintext highlighter-rouge">:</code>作为末行模式的说明符，等待用户输入命令。多数文件管理命令都是在此模式下执行的（如把编辑缓冲区的内容写到文件中等）。</p>

<p>末行命令执行完后，vi 自动回到命令模式。</p>

<h3 id="vi-工作模式之间的切换">vi 工作模式之间的切换</h3>

<p>如果要从命令模式转换到编辑模式，可以输入命令<code class="language-plaintext highlighter-rouge">a</code>或者<code class="language-plaintext highlighter-rouge">i</code>。</p>

<p>如果需要从文本模式返回，则按下<code class="language-plaintext highlighter-rouge">Esc</code>键即可。</p>

<p>在命令模式下输入<code class="language-plaintext highlighter-rouge">:</code>即可切换到末行模式，然后输入命令。</p>

<h2 id="进入vi编辑器vi打开文件">进入vi编辑器（vi打开文件）</h2>

<blockquote>
  <p>看似只是一个简单的打开功能，实际奥妙无穷！</p>
</blockquote>

<p>打开一个 shell 终端，在说明符后输入 vi和 想要编辑（或建立）的文件名，便可进入 vi 编辑器，其格式如下：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi filename
</code></pre></div></div>

<p>如果只输入 vi，而不带文件名，也可以进入 vi。这时编辑的文件是没有文件名的，所以在退出 vi 时，需要在退出命令后输入文件名，这样才能保证该文件被保存在磁盘中。</p>

<p>进入 vi 之后，首先进入的就是命令模式，也就是说等待命令输入而不是文本输入。这时输入的字母都将作为命令来解释。</p>

<p>光标表示 vi 编辑器的当前编辑位置停留在屏幕第 1 行首位上。其余各行行首均有一个<code class="language-plaintext highlighter-rouge">~</code>符号，表示该行为空行。</p>

<p>最后一行也称状态行，显示当前正在编辑的文件名及其状态。如本例是 [New File]，表示 test.c 是一个新建的文件，其中还没有任何内容。如果 test.c 文件已在系统中存在，那么输入上述命令后，则在屏幕上显示出该文件的内容，并且光标停在第 1 行的首位，在状态行显示出该文件的文件名、行数和字符数。</p>

<p>如果希望在进入 vi 后，光标处于文件中特定的某行上，可在 vi 命令上加上行号和文件名，其格式如下：</p>

<p>vi +行号 文件名</p>

<p>下例演示了打开一个文件并进行定位，在 shell 终端中输入打开 vi 编辑器的命令如下：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vi +5 test.c
</code></pre></div></div>

<p>光标将位于文件 test.c 中的第 5 行，语句<code class="language-plaintext highlighter-rouge">return a + b;</code>的行首。如果希望在进入 vi 之后光标处于文件最末行，则只需去掉命令中<code class="language-plaintext highlighter-rouge">+</code>后面的数字 n 即可，如下所示。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vi + test.c
</code></pre></div></div>

<p>这时光标会停留在最后一行的<code class="language-plaintext highlighter-rouge">}</code>字符。</p>

<p>vi 编辑器支持模式匹配，也就是说用户可以在命令中指定一个模式串。之后进入 vi 后，光标就处于文件中第一个与指定模式串相匹配的那行上。其格式如下：</p>

<p>vi +/模式字符串 文件名</p>

<p>下面实例演示查找 test.c 中的 main() 函数，并对其进行以下编辑：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vi +/main test.c
</code></pre></div></div>

<p>光标将停留在文件 test.c 中第 6 行的开头，如下所示。</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">sum</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">sum</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>如果需要取消高亮显示，可以在末行模式下使用以下命令：</p>

<p>:set nohlsearch</p>

<p>使用 vi 可以同时编辑多个文件，只要在进入 vi 的命令中写入所要操作的文件即可，还可以使用通配符，其格式如下：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vi 需要打开文件的通配符
</code></pre></div></div>

<p>如果需要打开当前目录下所有的C语言源文件，则可以使用以下命令：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vi <span class="k">*</span>.c
</code></pre></div></div>

<p>如果在一个C语言的工程中需要快速定位某函数并且对其进行编辑，则可以同时使用打开文件的通配符和模式匹配字符串。下例演示了如何在一个完整的工程中快速定位某个函数并且对其进行编辑。</p>

<p>1) 在 vi 编辑器中编辑 common.h 程序如下：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
</span><span class="k">extern</span> <span class="kt">void</span> <span class="nf">swap</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">b</span><span class="p">);</span>
</code></pre></div></div>

<p>2) 在 vi 编辑器中编辑 swap.c 程序如下。</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "common.h"
</span><span class="kt">void</span> <span class="nf">swap</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">tmp</span><span class="p">;</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="o">*</span><span class="n">a</span><span class="p">;</span>
    <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="o">*</span><span class="n">b</span><span class="p">;</span>
    <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>3) 在 vi 编辑器中编辑 main.c 程序如下。</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "common.h"
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">sacnf</span><span class="p">(</span><span class="s">"%d %d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
    <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d, %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>4) 保存并且退出 vi 编辑器。</p>

<p>5) 打开该程序中的所有源文件，并且将显示位置定位在 main() 函数上。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$vi</span> +/main <span class="k">*</span>.c <span class="k">*</span>.h
</code></pre></div></div>

<p>一个C程序的源文件一般只包括两种，即头文件（<code class="language-plaintext highlighter-rouge">.h</code>文件）和源文件（<code class="language-plaintext highlighter-rouge">.c</code>文件）。因此该命令执行后，将打开目录内所有的<code class="language-plaintext highlighter-rouge">.h</code>文件和<code class="language-plaintext highlighter-rouge">.c</code>文件，并且将当前编辑文件设置为 main.c 文件，光标置于 main.c 文件的第 3 行。</p>

<h2 id="vi修改文件内容文本修改命令">vi修改文件内容（文本修改命令）</h2>

<blockquote>
  <p>这里只要明白 i 就可以了，其他作为了解</p>
</blockquote>

<p>在命令模式下用户输入的任何字符都被 vi 当作命令加以解释执行，使用“文本修改命令”可以将 vi 切换到文本输入模式，这时用户输入的字符将被当作是文本内容。文本修改命令有以下几种。</p>

<h3 id="插入文本命令i-和-i">插入文本命令：i 和 I</h3>

<p>i 命令将文本插入到光标所在位置前。此时 vi 处于文本插入状态，屏幕最下行显示 “–INSERT–”说明信息。下面实例演示了使用 i 命令插入文本。</p>

<p>使用 i 命令，并输入相应文本后，屏幕显示如下：</p>

<p>hello real-world</p>

<p>I 命令将文本插入当前行的行首。当输入 I 命令后，光标自动移到该行的行首。下面实例演示了使用 I 命令插入文本。</p>

<p>使用 I 命令，并输入相应文本后，屏幕显示如下：</p>

<p>real-hello world</p>

<h3 id="追加文本命令a-和-a">追加文本命令：a 和 A</h3>

<p>a 命令将新文本追加到光标当前所在位置之后。下面示例演示了使用 a 命令追加文本。</p>

<p>hello world</p>

<p>光标位于“ ”（空格字符）之上，要在其后面追加。</p>

<p>real-</p>

<p>使用 a 命令，并输入相应文本后，屏幕显示如下：</p>

<p>hello real-world</p>

<p>A 命令将新文本追加到所在行的行尾。当输入 A 命令后，光标自动移到该行的行尾。下面示例演示了使用 A 命令追加文本。</p>

<p>hello world</p>

<p>光标位于“ ”（空格字符）之上，要在其后面追加。</p>

<p>real-</p>

<p>使用 A 命令，并输入相应文本后，屏幕显示如下：</p>

<p>hello worldreal-</p>

<h3 id="空行插入命令o-和-o">空行插入命令：o 和 O</h3>

<p>若用户希望在某行之前或某行之后插入一些新行，则应使用 o 命令。</p>

<ul>
  <li>o 命令将在光标所在行的下面插入一个空行，并将光标置于该行的行首。</li>
  <li>O 命令在光标所在行的上面插入一个空行，并将光标置于该行的行首。</li>
</ul>

<h2 id="vi文本删除命令删除文件内容">vi文本删除命令（删除文件内容）</h2>

<blockquote>
  <p>直接进入编辑模式删除不好吗，为什么要在命令模式下操作？</p>
</blockquote>

<p>vi 编辑器可以在编辑模式和命令模式下删除文本。</p>

<p>传统的文本删除是在编辑模式下，使用退格键或 Del 键删除文本。</p>

<p>在命令模式下，vi 提供了许多删除命令。常用命令如下表所示：</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">文本删除命令</th>
      <th>命令的意义</th>
      <th style="text-align: left">文本删除命令</th>
      <th style="text-align: left">命令的意义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">x</td>
      <td>删除光标处的字符</td>
      <td style="text-align: left">d(</td>
      <td style="text-align: left">删除到上一句开始的所有字符</td>
    </tr>
    <tr>
      <td style="text-align: left">X</td>
      <td>删除光标前面的字符</td>
      <td style="text-align: left">d)</td>
      <td style="text-align: left">删除到下一句开始的所有字符</td>
    </tr>
    <tr>
      <td style="text-align: left">dd</td>
      <td>删除光标所在的整行</td>
      <td style="text-align: left">d{</td>
      <td style="text-align: left">删除到上一段开始的所有字符</td>
    </tr>
    <tr>
      <td style="text-align: left">D 或 d$</td>
      <td>删除从光标所在处开始到行尾 的内容</td>
      <td style="text-align: left">d}</td>
      <td style="text-align: left">删除到下一段开始的所有字符</td>
    </tr>
    <tr>
      <td style="text-align: left">d0</td>
      <td>删除从光标前一个字符开始到 行首的内容</td>
      <td style="text-align: left">d<CR></CR></td>
      <td style="text-align: left">删除包括当前行在内的两行字符</td>
    </tr>
    <tr>
      <td style="text-align: left">dw</td>
      <td>删除一个单词</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
    </tr>
  </tbody>
</table>

<p>删除文本的命令可以分为删除单个字符和删除多个字符两类。其中，删除单个字符的命令包括下面两种情况。</p>

<ul>
  <li>x 命令：删除光标处的字符。若在 x 之前加上一个数字 n，则删除从光标所在位置开始向右的 n 个字符。</li>
  <li>X 命令：删除光标前面的字符。若在 X 之前加上一个数字 n，则删除从光标前面那个字符开始向左的 n 个字符。</li>
</ul>

<p>删除多个字符的命令包括下面几种情况。</p>

<ul>
  <li>dd 命令：该命令删除光标所在的整行。在 dd 前可加上一个数字 n，表示删除当前行及其后 n-1 行的内容。</li>
  <li>D 命令或 d$ 命令：两个命令功能一样，都是删除从光标所在处开始到行尾的内容。</li>
  <li>d0 命令：该命令删除从光标前一个字符开始到行首的内容。</li>
  <li>dw 命令：该命令删除一个单词。若光标处在某个词的中间，则从光标所在位置开始删至词尾。同 dd 命令一样，可在 dw 之前加一个数字n，表示删除 n 个指定的单词。</li>
  <li>d( 命令：该命令删除到上一句开始的所有字符。</li>
  <li>d) 命令：该命令删除到下一句开始的所有字符。</li>
  <li>d} 命令：该命令删除到上一段开始的所有字符。</li>
  <li>d{ 命令：该命令删除到下一段开始的所有字符。</li>
  <li>d<CR> 命令：该命令（<CR>表示回车）删除包括当前行在内的两行字符。</CR></CR></li>
</ul>

<p>下面实例演示了删除字符的操作。</p>

<p>1) 在 vi 编辑器中编辑以下程序清单，屏幕显示如下。</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">sum</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">sum</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="s">"test.c"</span> <span class="mi">13L</span><span class="p">,</span> <span class="mi">175</span><span class="n">C</span>
</code></pre></div></div>

<p>2) 将光标移至第 6 行的 main 的 a 字符上，在命令模式下使用 d<CR> 命令删除当前所在行及其下面一行的内容。执行删除操作之后如下所示。</CR></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">sum</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">sum</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>
  <span class="p">}</span>
<span class="err">}</span>
</code></pre></div></div>

<h2 id="vi文本复制命令复制文件内容">vi文本复制命令（复制文件内容）</h2>

<p>vi 编辑器可以在编辑模式和命令模式下复制文本。常用的复制文本的命令如下表所示。</p>

<table>
  <thead>
    <tr>
      <th>文本复制命令</th>
      <th>命令的意义</th>
      <th>文本复制命令</th>
      <th>命令的意义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>yy</td>
      <td>复制光标所在的整行</td>
      <td>y{</td>
      <td>复制到上一段的开始</td>
    </tr>
    <tr>
      <td>Y 或 y$</td>
      <td>复制从光标所在处开始到行尾的内容</td>
      <td>y}</td>
      <td>复制到下一段的开始</td>
    </tr>
    <tr>
      <td>y0</td>
      <td>复制从光标前一个字符开始到行首的内容</td>
      <td>y<CR></CR></td>
      <td>复制包括当前行在内的两行内容</td>
    </tr>
    <tr>
      <td>y(</td>
      <td>复制到上一句的开始</td>
      <td>yw</td>
      <td>复制一个单词</td>
    </tr>
    <tr>
      <td>y)</td>
      <td>复制到下一句的开始</td>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<ul>
  <li>yy 命令：复制光标所在的整行。在 yy 前可加一个数字 n，表示复制当前行及其后 n-1 行的内容。</li>
  <li>Y 或 y$ 命令：两命令功能一样，都是复制从光标所在处开始到行尾的内容。</li>
  <li>yw 命令：复制一个单词。若光标处在某个词的中间，则从光标所在位置开始复制至词尾。同 yy 命令一样，可在 yw 之前加一个数字 n，表示复制 n 个指定的单词。</li>
  <li>y) 命令：复制到下一句幵始的所有字符。</li>
  <li>y} 命令：复制到下一段开始的所有字符。</li>
  <li>y<CR> 命令（<CR> 表示回车）：复制包括当前行在内的两行内容。</CR></CR></li>
</ul>

<p>与文本复制有关的命令分为两类。</p>

<h4 id="1-文本粘贴命令">1. 文本粘贴命令</h4>

<ul>
  <li>p 命令：粘贴命令，粘贴当前缓冲区中的内容。</li>
</ul>

<h4 id="2-文本选择命令">2. 文本选择命令</h4>

<ul>
  <li>v 命令：在命令模式下进行文本选择。在需要选择的文本的起始处按下 v 键进入块选择模式，然后移动光标到块尾处。这之间的部分被高亮显示，表示被选中。</li>
  <li>V 命令：在命令模式下按行进行文本选择。在需要选择的文本的第一行按下 V 键，然后移动光标到块的最后一行。这之间的所有行被高亮显示，表示被选中。</li>
</ul>

<p>vi 编辑器支持最近编辑内容的恢复，但是由于 vi 编辑器使用寄存器存放最近内容，所以恢复能力有限。vi 编辑器使用 9 个寄存器，可以存放已经删除的 9 个最近内容，这些内容可以被恢复。下面实例简述了这种机制。</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"please input a number: </span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">scanf</span><span class="p">(</span><span class="s">" % d "</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
  <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">100</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">j = %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>现在对其进行如下操作。</p>

<p>1) 将光标移至文件第 1 行，输入 dd 命令，此时文件第 1 行的内容被删除，且被删除的内容保存在寄存器 1 中。这行的内容是<code class="language-plaintext highlighter-rouge">#indude &lt;stdio.h&gt;</code>，被保存在寄存器 1 中。</p>

<p>2) 将光标下移至第 1 个 printf 语句行，输入 dd 命令将该行删除，此时寄存器 1 中将保存刚刚被删除的内容。也就是说<code class="language-plaintext highlighter-rouge">#indude &lt;stdio.h&gt;</code>被保存到了寄存器 2 中，而<code class="language-plaintext highlighter-rouge">printf("please input a number: \n");</code>这一行的内容被保存在了寄存器 1 中。</p>

<h2 id="vi撤销命令u和u撤销上一次的操作">vi撤销命令（u和U），撤销上一次的操作</h2>

<p>撤销命令是非常有用的，它可以撤销前一次的误操作或不合适的操作对文件造成的影响。撤销命令分为以下两种。</p>

<ul>
  <li>u 命令：该命令撤销上一次所做的操作。多次使用 u 命令会一步一步依次撤销之前做过的操作（在一次切换到文本输入模式中输入的所有文本算一次操作）。</li>
  <li>U 命令：该命令会一次性撤销自上次移动到当前行以来做过的所有操作，再使用一次 U 命令则撤销之前的 U 命令所做的操作，恢复被撤销的内容。</li>
</ul>

<p>下面实例演示了两个命令的区别。</p>

<p>1) 在 vi 编辑器中编辑以下代码：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"hello world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>2) 光标停留在 h 的左侧，在命令模式下输入命令 o 插入一新行，输入需要插入的内容后再按下 Esc 键回到命令模式，屏幕显示内容如下：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"hello world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"hello real-world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"hello world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>3) 使用命令 U 后，取消所有操作，屏幕显示为：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"hello world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>4) 使用命令 u 后，仅取消第 2 个输入的串<code class="language-plaintext highlighter-rouge">printf("hello world\n");</code>，屏幕显示为：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"hello world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"hello real-world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="重复命令">重复命令</h2>

<p>当用户在文本编辑中碰到需要机械地重复一些操作的时候，重复命令就派上了用场。它可以让用户方便地再执行一次前面刚完成的某个复杂的命令。重复命令只能在命令模式下工作，在该模式下按下<code class="language-plaintext highlighter-rouge">.</code>键即可。下面实例演示了使用重复命令。</p>

<p>1) 在 vi 编辑器中编辑以下代码：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>2) 让光标位于<code class="language-plaintext highlighter-rouge">return 0;</code>所在的行，输入命令<code class="language-plaintext highlighter-rouge">O</code>，并输入一行内容后，再按下 Esc 键回到命令模式下，屏幕显示内容为：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">printf</span> <span class="p">(</span><span class="s">"http://c.biancheng.net</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>3) 此时输入命令<code class="language-plaintext highlighter-rouge">.</code>，重复上次键入<code class="language-plaintext highlighter-rouge">printf ("http://c.biancheng.net\n");</code>的操作，屏幕显示内容为：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">printf</span> <span class="p">(</span><span class="s">"http://c.biancheng.net</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">printf</span> <span class="p">(</span><span class="s">"http://c.biancheng.net</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="退出">退出</h2>

<p>准备退出 vi 的方式有多种方法，下面进行详细介绍。</p>

<h3 id="1-命令q">1. 命令q</h3>

<p>在末行模式下，输入命令如下：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:q
</code></pre></div></div>

<p>如果退出时当前编辑文件尚未保存，则 vi 并不退出，而是继续等待用户的命令，并且会在显示窗口的最末行说明如下信息：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>No write since last change <span class="o">(</span>use! to overrides<span class="o">)</span>
</code></pre></div></div>

<p>说明：当用户不清楚自己当前编译的文件是否被修改时，可以使用该命令进行测试，而不必担心因为误操作导致文件数据丢失。</p>

<h3 id="2-命令-q">2. 命令 q!</h3>

<p>在末行模式下，输入命令如下：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:q!
</code></pre></div></div>

<p>该命令不论文件是否改变都会强行退出 vi 编辑器，对于此命令用户应当慎用。</p>

<h3 id="3-命令-w">3. 命令 w</h3>

<p>在末行模式下，输入命令如下：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:w  新文件名
</code></pre></div></div>

<p>vi 保存当前编辑文件，但并不退出，而是继续等待用户输入命令。在使用 w 命令时，可以再给当前编辑文件起一个新的文件名。这个功能相当于将该文件另存为为一个新的文件。下面实例演示了将 main.c 文件另存为 test.c 文件。</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "common.h"
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">sacnf</span><span class="p">(</span><span class="s">"%d %d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">af</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
  <span class="n">swap</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
  <span class="n">printf</span> <span class="p">(</span><span class="s">"%d, %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">:</span><span class="n">w</span> <span class="n">test</span><span class="p">.</span><span class="n">c</span>
</code></pre></div></div>

<p>保存之后使用<code class="language-plaintext highlighter-rouge">:q</code>命令退出 vi 编辑器，使用 ls 命令查看当前目录下的文件时，会发现多了一个 test.c 文件，该文件的内容和 main.c 一致。可以使用 cat 命令查看该文件的内容，main.c 文件的内容不受影响。若指定的新文件是一个已存在的文件，则 vi 在显示窗口的状态行给出如下说明信息：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>File exists <span class="o">(</span>use! to override<span class="o">)</span>
</code></pre></div></div>
<p>说明：这样做同样可以防止因误操作覆盖已经存在的文件，用户可以选择另外的文件名来保存当前文件。</p>

<h3 id="4-命令-w">4. 命令 w!</h3>

<p>在末行模式下，输入命令如下：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:w!  新文件名
</code></pre></div></div>
<p>说明：该命令与<code class="language-plaintext highlighter-rouge">:w</code>命令相同，所不同的是，即使指定的新文件存在，vi 编辑器也会用当前编辑文件对其进行替换，而不再询问用户。因此，此命令同样要慎用。</p>

<h3 id="5-命令-wq">5. 命令 wq</h3>

<p>在末行模式下，输入命令如下：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:wq
</code></pre></div></div>
<p>vi 将先保存文件，然后退出 vi 返回到 shell。如果当前文件尚未取名，则需要现指定一个文件名。</p>

<h3 id="6-命令-x">6. 命令 x</h3>

<p>在末行模式下，输入命令如下：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:x
</code></pre></div></div>
<p>说明：若当前编辑文件曾被修改过，则 vi 会保存该文件。否则 vi 直接退出，不保存该文件。</p>

<p>vi 编辑器可以对文本进行替换操作，其命令如下。</p>

<h3 id="1-r-命令">1. r 命令</h3>

<p>该命令将当前光标所指的字符替换为提供的字符。可以在该命令之前加上数字 n，表示将从当前字符开始的 n 个字符替换为提供的字符。下面实例演示了 r 命令的使用。</p>

<p>1) 在 vi 编辑器中编辑以下代码：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">sum</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">sum</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="s">"test.c"</span> <span class="mi">13L</span><span class="p">,</span> <span class="mi">170</span><span class="n">C</span>
</code></pre></div></div>

<p>2) 将光标移至 main 的首字符<code class="language-plaintext highlighter-rouge">a</code>上，在命令行模式下输入 4rb，显示如下：</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">mbbbbvoid</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">sum</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">sum</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="s">"test.c"</span> <span class="mi">13L</span><span class="p">,</span> <span class="mi">170</span><span class="n">C</span>
</code></pre></div></div>
<h3 id="2-r命令">2. R命令</h3>

<p>该命令会让 vi 进入 replace 模式。在此模式下，每个输入的字符都会替换当前光标下的字符，直到输入 <Esc> 结束该模式。</Esc></p>

:ET